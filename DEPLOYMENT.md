# –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

Auto-updater –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ **–ù–ï** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Docker Desktop. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º Docker Registry –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (`localhost:5000`).

## –ü—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

### –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

```
Docker Desktop (–ª–æ–∫–∞–ª—å–Ω–æ) 
    ‚Üì (–≤—Ä—É—á–Ω—É—é)
–°–µ—Ä–≤–µ—Ä Registry (localhost:5000)
    ‚Üì (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫)
Auto-Updater
    ‚Üì (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

### –®–∞–≥–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. **–õ–æ–∫–∞–ª—å–Ω–æ (Docker Desktop):**
   ```bash
   # –°–æ–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
   docker build -t myapp:v1.1 .
   
   # –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ–≥ –¥–ª—è registry –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   docker tag myapp:v1.1 89.111.155.164:5000/myapp:v1.1
   
   # –û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ–±—Ä–∞–∑ –≤ registry –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   docker push 89.111.155.164:5000/myapp:v1.1
   ```

2. **–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):**
   - Auto-updater –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç registry
   - –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –†—É—á–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (—Ç–µ–∫—É—â–∏–π)

```bash
# 1. –õ–æ–∫–∞–ª—å–Ω–æ: —Å–æ–±—Ä–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑
docker build -t myapp:latest .
docker tag myapp:latest 89.111.155.164:5000/myapp:latest
docker push 89.111.155.164:5000/myapp:latest

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: Auto-updater –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: CI/CD –ø–∞–π–ø–ª–∞–π–Ω (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–æ–∑–¥–∞–π—Ç–µ GitHub Actions –∏–ª–∏ GitLab CI –ø–∞–π–ø–ª–∞–π–Ω:

```yaml
# .github/workflows/deploy.yml
name: Deploy to Server

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Build Docker image
        run: docker build -t myapp:${{ github.sha }} .
      
      - name: Tag image
        run: docker tag myapp:${{ github.sha }} 89.111.155.164:5000/myapp:latest
      
      - name: Push to registry
        run: docker push 89.111.155.164:5000/myapp:latest
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `deploy.sh`:

```bash
#!/bin/bash
# deploy.sh - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

SERVER="89.111.155.164"
REGISTRY_PORT="5000"
IMAGE_NAME="myapp"
VERSION=$(git rev-parse --short HEAD)

echo "üî® –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞..."
docker build -t ${IMAGE_NAME}:${VERSION} .

echo "üì¶ –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞..."
docker tag ${IMAGE_NAME}:${VERSION} ${SERVER}:${REGISTRY_PORT}/${IMAGE_NAME}:latest
docker tag ${IMAGE_NAME}:${VERSION} ${SERVER}:${REGISTRY_PORT}/${IMAGE_NAME}:${VERSION}

echo "üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ registry..."
docker push ${SERVER}:${REGISTRY_PORT}/${IMAGE_NAME}:latest
docker push ${SERVER}:${REGISTRY_PORT}/${IMAGE_NAME}:${VERSION}

echo "‚úÖ –û–±—Ä–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. Auto-updater –æ–±–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ —Ç–µ—á–µ–Ω–∏–µ 30 —Å–µ–∫—É–Ω–¥."
```

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1. **Registry –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ:**
   - –¢–µ–∫—É—â–∏–π registry –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (`localhost:5000`)
   - –î–ª—è push –∏–∑ Docker Desktop –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∏–∑–≤–Ω–µ

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ registry:**

   –û–±–Ω–æ–≤–∏—Ç–µ `docker-compose.yml` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–Ω–µ:
   ```yaml
   registry:
     ports:
       - "0.0.0.0:5000:5000"  # –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
   ```

   –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ nginx reverse proxy —Å SSL.

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - Registry –±–µ–∑ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º
   - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ Registry

–î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–∑–≤–Ω–µ:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ registry**
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS (—á–µ—Ä–µ–∑ nginx —Å SSL)**
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –ø–æ IP**

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–±—Ä–∞–∑–∞:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ auto-updater
cd /root/Autodeploy
docker compose logs -f auto-updater

# –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–ª—è localhost:5000/myapp:latest..."
# "–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–ª—è localhost:5000/myapp:latest"
# "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ myapp..."
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ registry:

```bash
# –°–ø–∏—Å–æ–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤ registry
curl http://89.111.155.164:5000/v2/_catalog

# –°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ –æ–±—Ä–∞–∑–∞
curl http://89.111.155.164:5000/v2/myapp/tags/list
```

## –†–µ–∑—é–º–µ

- ‚ùå **–ù–ï–¢**: Docker Desktop ‚Üí –°–µ—Ä–≤–µ—Ä (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- ‚úÖ **–î–ê**: Docker Desktop ‚Üí Registry ‚Üí Auto-updater ‚Üí –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (—Å —Ä—É—á–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ registry)
- ‚úÖ **–î–ê**: CI/CD ‚Üí Registry ‚Üí Auto-updater ‚Üí –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

–î–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ CI/CD –ø–∞–π–ø–ª–∞–π–Ω, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–±—Ä–∞–∑—ã –≤ registry –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ.

